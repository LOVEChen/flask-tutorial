# 004. 获取 URL 参数
URL参数是出现在url中的键值对，例如`http://127.0.0.1:5000/?disp=3`中的url参数是`{'disp':3}`。


### 4.1 建立Flask项目

按照以下命令建立Flask项目HelloWorld:
```
mkdir HelloWorld
mkdir HelloWorld/static
mkdir HelloWorld/templates
touch HelloWorld/server.py
```

### 4.2 列出所有的url参数

在server.py中添加以下内容：
```python
from flask import Flask, request

app = Flask(__name__)


@app.route('/')
def hello_world():
    return request.args.__str__()


if __name__ == '__main__':
    app.run(port=5000, debug=True)
```

在浏览器中访问`http://127.0.0.1:5000/?user=Flask&time&p=7&p=8`，将显示：
```
ImmutableMultiDict([('user', 'Flask'), ('time', ''), ('p', '7'), ('p', '8')])
```
较新的浏览器也支持直接在url中输入中文（最新的火狐浏览器内部会帮忙将中文转换成符合URL规范的数据），在浏览器中访问`http://127.0.0.1:5000/?info=这是爱，`，将显示：
```
ImmutableMultiDict([('info', '这是爱，')])
```

浏览器传给我们的Flask服务的数据长什么样子呢？可以通过`request.full_path`和`request.path`来看一下：
```python
from flask import Flask, request

app = Flask(__name__)


@app.route('/')
def hello_world():
    print(request.path)
    print(request.full_path)
    return request.args.__str__()


if __name__ == '__main__':
    app.run(port=5000, debug=True)
```
浏览器访问`http://127.0.0.1:5000/?info=这是爱，`，运行`server.py`的终端会输出：
```
/
/?info=%E8%BF%99%E6%98%AF%E7%88%B1%EF%BC%8C
```

### 4.3 获取某个指定的参数

例如，要获取键`info`对应的值，如下修改`server.py`：
```
from flask import Flask, request

app = Flask(__name__)

@app.route('/')
def hello_world():
    return request.args.get('info')

if __name__ == '__main__':
    app.run(port=5000)
```
运行`server.py`，在浏览器中访问`http://127.0.0.1:5000/?info=hello`，浏览器将显示：
```
hello
```
不过，当我们访问`http://127.0.0.1:5000/`时候却出现了500错误，浏览器显示：
![](/content/images/learn-flask/flask-001.jpg)

如果开启了Debug模式，会显示：
![](/content/images/learn-flask/flask-002.jpg)

为什么为这样？

这是因为没有在URL参数中找到`info`。所以`request.args.get('info')`返回Python内置的None，而Flask不允许返回None。

解决方法很简单，我们先判断下它是不是None：

```python
from flask import Flask, request

app = Flask(__name__)

@app.route('/')
def hello_world():
    r = request.args.get('info')
    if r==None:
        # do something
        return ''
    return r

if __name__ == '__main__':
    app.run(port=5000, debug=True)

```

另外一个方法是，设置默认值，也就是取不到数据时用这个值：
```
from flask import Flask, request

app = Flask(__name__)

@app.route('/')
def hello_world():
    r = request.args.get('info', 'hi')
    return r

if __name__ == '__main__':
    app.run(port=5000, debug=True)
```
函数`request.args.get`的第二个参数用来设置默认值。此时在浏览器访问`http://127.0.0.1:5000/`，将显示：
```
hi
```

### 4.4 如何处理多值
还记得上面有一次请求是这样的吗？ `http://127.0.0.1:5000/?user=Flask&time&p=7&p=8`，仔细看下，`p`有两个值。

如果我们的代码是：
```python
from flask import Flask, request

app = Flask(__name__)

@app.route('/')
def hello_world():
    r = request.args.get('p')
    return r

if __name__ == '__main__':
    app.run(port=5000, debug=True)
```
在浏览器中请求时，我们只会看到`7`。如果我们需要把`p`的所有值都获取到，该怎么办？

不用`get`，用`getlist`：
```python
from flask import Flask, request

app = Flask(__name__)


@app.route('/')
def hello_world():
    r = request.args.getlist('p')  # 返回一个list
    return str(r)


if __name__ == '__main__':
    app.run(port=5000, debug=True)
```
浏览器输入 `http://127.0.0.1:5000/?user=Flask&time&p=7&p=8`，我们会看到`['7', '8']`。

### 4.5 本节源码
https://github.com/letiantian/flask-tutorial/tree/master/demo/flask-demo-002


<!-- flask-tutorial-info -->


---

* 上一篇 [003. 从 Hello World 开始](003.%20%E4%BB%8E%20Hello%20World%20%E5%BC%80%E5%A7%8B.md)
* 下一篇 [005. 获取POST方法传送的数据](005.%20%E8%8E%B7%E5%8F%96POST%E6%96%B9%E6%B3%95%E4%BC%A0%E9%80%81%E7%9A%84%E6%95%B0%E6%8D%AE.md)

> 本教程讲述如何使用 Python Flask Web 框架，如有错误/建议，欢迎交流。

